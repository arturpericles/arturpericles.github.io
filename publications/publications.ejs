<%
// --- Filter items into categories ---
// This logic is based on the citation.type in your .yml files
// and matches the groupings in publications_overview.md

const bookChapters = items.filter(item => 
item.citation.type === 'chapter'
);

const policyReports = items.filter(item => 
item.citation.type === 'report' || 
item.citation.type === 'article-magazine'
);

const researchArticles = items.filter(item =>
item.citation.type === 'manuscript' ||
item.citation.type === 'article-journal' ||
item.citation.type === 'paper-conference'
);
%>

<!-- 
======================
Research Articles
======================
-->
<h2>Research Articles</h2>

<% if (researchArticles.length > 0) { %>
::: {.list .quarto-listing-default}
<% for (const item of researchArticles) { %>
::: {.quarto-post .image-right}
::: {.body}
<% if (item.title) { %>
<h5 class="no-anchor listing-title"><a href="<%- item.path %>" class="no-external"><%= item.title %></a></h5>
<% if (item.title_en) { %>
<div class="listing-subtitle"><a href="<%- item.path %>" class="no-external"><%= item.title_en %></a></div>
<% } %>
<% } %>
:::
::: {.metadata}
<% if (item.date) { %>
<div class="listing-date"><%= item.date %> 
<%if (item.citation.status) { %> (<%= item.citation.status %>) <% } else if (item.citation.type == 'manuscript') { %> (<%= item.citation.type %>)<% } %>
</div>
<% } %>
<% if (item.author && item.author !== 'Artur Pericles Lima Monteiro' && item.author !== 'Artur Pericles L. Monteiro') { %>
<div class="listing-author"><%= item.author %></div>
<% } %>
<% if ( (item.citation?.["container-title-short"] || item.citation?.["container-title"]) || (item.citation?.type === 'report' && item.citation?.publisher) ) { %>
<div class="metadata-value"><% if (item.citation?.type === 'report' && item.citation?.publisher) { %>
<%= item.citation.publisher %><% } else { %>
<%= item.citation["container-title"] || item.citation["container-title-short"] %><% 
if (item["container-title-short_en"]) { %> [<%= item["container-title-short_en"] %>]<% } else if (item["container-title_en"]) { %> [<%= item["container-title_en"] %>]<% } %><% 
if (item.citation?.publisher && (item.citation.type === 'book' || item.citation.type === 'chapter')) { 
%> (<%= item.citation.publisher %>)<% 
} %><% } %>
</div>
<% } %>
<% if (item.fulltext) { %>
<div class="listing-preprint"><a href="<%= item.fulltext %>" class="btn btn-sm btn-secondary" target="_blank" rel="noopener">full text</a></div>
<% } %>
:::
:::
<% } %>
:::
<% } else { %>
<p><em>(No publications in this category yet.)</em></p>
<% } %>


<!-- 
======================
Book Chapters
======================
-->
<h2>Book Chapters</h2>

<% if (bookChapters.length > 0) { %>
::: {.list .quarto-listing-default}
<% for (const item of bookChapters) { %>
::: {.quarto-post .image-right}
::: {.body}
<% if (item.title) { %>
<h5 class="no-anchor listing-title"><a href="<%- item.path %>" class="no-external"><%= item.title %></a></h5>
<% if (item.title_en) { %>
<div class="listing-subtitle"><a href="<%- item.path %>" class="no-external"><%= item.title_en %></a></div>
<% } %>
<% } %>
:::
::: {.metadata}
<% if (item.date) { %>
<div class="listing-date"><%= item.date %> 
<%if (item.citation.status) { %> (<%= item.citation.status %>) <% } else if (item.citation.type == 'manuscript') { %> (<%= item.citation.type %>)<% } %>
</div>
<% } %>
<% if (item.author && item.author !== 'Artur Pericles Lima Monteiro' && item.author !== 'Artur Pericles L. Monteiro') { %>
<div class="listing-author"><%= item.author %></div>
<% } %>
<% if ( (item.citation?.["container-title-short"] || item.citation?.["container-title"]) || (item.citation?.type === 'report' && item.citation?.publisher) ) { %>
<div class="metadata-value"><% if (item.citation?.type === 'report' && item.citation?.publisher) { %>
<%= item.citation.publisher %><% } else { %>
<%= item.citation["container-title"] || item.citation["container-title-short"] %><% 
if (item["container-title-short_en"]) { %> [<%= item["container-title-short_en"] %>]<% } else if (item["container-title_en"]) { %> [<%= item["container-title_en"] %>]<% } %><% 
if (item.citation?.publisher && (item.citation.type === 'book' || item.citation.type === 'chapter')) { 
%> (<%= item.citation.publisher %>)<% 
} %><% } %>
</div>
<% } %>
<% if (item.fulltext) { %>
<div class="listing-preprint"><a href="<%= item.fulltext %>" class="btn btn-sm btn-secondary" target="_blank" rel="noopener">full text</a></div>
<% } %>
:::
:::
<% } %>
:::
<% } else { %>
<p><em>(No publications in this category yet.)</em></p>
<% } %>


<!-- 
=====================================
Policy Reports and Other Writing
=====================================
-->
<h2>Policy Reports and Other Writing</h2>

<% if (policyReports.length > 0) { %>
::: {.list .quarto-listing-default}
<% for (const item of policyReports) { %>
::: {.quarto-post .image-right}
::: {.body}
<% if (item.title) { %>
<h5 class="no-anchor listing-title"><a href="<%- item.path %>" class="no-external"><%= item.title %></a></h5>
<% if (item.title_en) { %>
<div class="listing-subtitle"><a href="<%- item.path %>" class="no-external"><%= item.title_en %></a></div>
<% } %>
<% } %>
:::
::: {.metadata}
<% if (item.date) { %>
<div class="listing-date"><%= item.date %> 
<%if (item.citation.status) { %> (<%= item.citation.status %>) <% } else if (item.citation.type == 'manuscript') { %> (<%= item.citation.type %>)<% } %>
</div>
<% } %>
<% if (item.author && item.author !== 'Artur Pericles Lima Monteiro' && item.author !== 'Artur Pericles L. Monteiro') { %>
<div class="listing-author"><%= item.author %></div>
<% } %>
<% if ( (item.citation?.["container-title-short"] || item.citation?.["container-title"]) || (item.citation?.type === 'report' && item.citation?.publisher) ) { %>
<div class="metadata-value"><% if (item.citation?.type === 'report' && item.citation?.publisher) { %>
<%= item.citation.publisher %><% } else { %>
<%= item.citation["container-title"] || item.citation["container-title-short"] %><% 
if (item["container-title-short_en"]) { %> [<%= item["container-title-short_en"] %>]<% } else if (item["container-title_en"]) { %> [<%= item["container-title_en"] %>]<% } %><% 
if (item.citation?.publisher && (item.citation.type === 'book' || item.citation.type === 'chapter')) { 
%> (<%= item.citation.publisher %>)<% 
} %><% } %>
</div>
<% } %>
<% if (item.fulltext) { %>
<div class="listing-preprint"><a href="<%= item.fulltext %>" class="btn btn-sm btn-secondary" target="_blank" rel="noopener">full text</a></div>
<% } %>
:::
:::
<% } %>
:::
<% } else { %>
<p><em>(No publications in this category yet.)</em></p>
<% } %>